{% assign chapter_num = 0 %}
{% for chapter in site.custom.chapters %}
  {% if page.url contains chapter.slug %}
    {% assign chapter_num = forloop.index %}
  {% endif %}
{% endfor %}

{% assign exercise_num = 1 %}
{% if site.data.exercises[page.slug] %}
  {% assign exercise_num = site.data.exercises[page.slug] | plus: 1 %}
{% endif %}

{% capture new_exercise_num %}{{ chapter_num }}.{{ exercise_num }}{% endcapture %}

<div class="exercise" id="exercise-{{ new_exercise_num }}">
  <div class="exercise-header">
    <span class="exercise-title">Упражнение {{ new_exercise_num }}</span>
  </div>
  <div class="exercise-content">
    {{ include.content | markdownify }}
  </div>
</div>

{% assign exercise_data = site.data.exercises | default: {} %}
{% assign exercise_data = exercise_data | hash_merge: { page.slug: exercise_num } %}
{% assign exercises = exercise_data | to_json %}
<script type="text/json" id="exercises-data">{{ exercises }}</script>

<style>
.exercise {
  border-left: 4px solid #4caf50;
  padding: 10px 15px;
  margin: 20px 0;
  background-color: #f5f5f5;
}
.exercise-header {
  font-weight: bold;
  margin-bottom: 8px;
  color: #4caf50;
}
</style>
